@startuml Deployment Diagram
!theme plain

skinparam node {
  BackgroundColor WhiteSmoke
  BorderColor DarkBlue
  ArrowColor #444444
}

skinparam component {
  BackgroundColor White
  BorderColor Black
}

skinparam cloud {
  BackgroundColor LightCyan
  BorderColor DarkCyan
}

skinparam database {
  BackgroundColor White
  BorderColor Black
}

title Uber Application Deployment Diagram (Physical View)

' --- Client Tier ---
node "User Smartphone" <<device>> as SmartPhone {
  component [Mobile App Instance\n(iOS/Android)] as MobileApp
}

node "User Computer" <<device>> as Computer {
  node "Web Browser" <<execution environment>> {
    component [Web App Instance\n(React SPA)] as WebApp
  }
}

' --- External Systems ---
node "External Payment Provider" <<external>> {
  component [Stripe API] as Stripe
}

' --- Cloud Infrastructure ---
cloud "Cloud Infrastructure (AWS)" {

  node "Content Delivery Network / Web Server" as CDN {
    artifact "React Static Files"
  }

  node "Load Balancer / Ingress" as LB {
    component [Nginx Gateway] as Nginx
  }

  ' --- Compute Cluster ---
  node "Kubernetes Cluster (Application Tier)" as K8s {
    node "Pod" {
      component [User Service] as UserService
      component [Payment Service] as PaymentService
      component [Driver Service] as DriverService
      component [Notification Service] as NotifService
    }
  }

  ' --- Middleware & Data ---
  node "Message Broker Cluster" as KafkaCluster {
    queue [Kafka Topic] as Kafka
  }

  node "Redis Cluster" as RedisNode {
    component [Redis Cache] as Redis
  }

  node "Database Server (Primary)" as DBServer {
    database [PostgreSQL] as Postgres
  }
}

' --- Relationships ---

' Client to Infrastructure
MobileApp --> Nginx : HTTPS (JSON)
Computer --> CDN : HTTPS (Fetch Static Assets)
WebApp --> Nginx : HTTPS (API Calls)

' Gateway to Services
Nginx --> UserService : REST
Nginx --> PaymentService : REST
Nginx --> DriverService : REST
Nginx --> NotifService : REST

' Service to Database
UserService --> Postgres : TCP
PaymentService --> Postgres : TCP
DriverService --> Postgres : TCP
NotifService --> Postgres : TCP

' Service to Cache
UserService ..> Redis : TCP
PaymentService ..> Redis : TCP
DriverService ..> Redis : TCP
NotifService ..> Redis : TCP

' Service to Messaging
UserService --> Kafka : Publish
PaymentService --> Kafka : Publish
DriverService --> Kafka : Publish
NotifService --> Kafka : Subscribe

' Inter-service via Queue (Example)
Kafka ..> NotifService : Consume Events

' External
PaymentService --> Stripe : HTTPS (TLS)

@enduml